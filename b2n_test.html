<!DOCTYPE html>
<html>
<head>
<title>Buffer to Numbers test</title>
<style>
  hr { color:lightgray; }
  .ta-r { text-align: right; }
  .nowr { white-space: nowrap; }
  .wron { white-space: normal; }
  .bgc { background-color: #abc; }
  button { height:1.72em; }
  button .bt2 { width:16px; height:20px; }
</style>
<script src="b2n.js"></script>
<!-- link rel=stylesheet src="lib/bootstrap.css"></link -->
<script>

var s = '', i = 0, n = 0, dt = new Date();
var LF = '\n', TAB = '\t', PREBR = '<pre><br>';
var a0 = [0x53F5595C, 0x3DD8A8F8, 0x218487B, 0x880717F1, 0xA8F5C621, 0x87D0631D, 0xF12E95D0, 0x6C045D54, 0xD38CC558, 0xB22D35D2, 0x7997DFFE, 0x69FFAA17, 0xCC550612, 0xC26B65F5, 0x3B1D4BFE, 0x865CF801, 0xD0B64A12, 0x3DC0E98C, 0xC26B65F6, 0x3B1D4BFE, 0x32679EA5, 0x92DDA11A, 0x3BA8A111, 0x3A644E05, 0x922785DD, 0xFE8C94E3, 0xDF87B441, 0xD1BC8C37, 0xEEDEA09D, 0x88F0162B, 0xCC51802, 0x66B69FFB, 0x716BE37A, 0];
var a1 = [0, 0xF7C01828, 0xA609AFCD, 0x487C8F0B, 0xCC0ACCA0, 0xE5B5692F, 0x4E93465F, 0xA896E6DC, 0x1EA32931, 0x8EF9496, 0x4BA043A9, 0xF75F85DF, 0xEB47FD6, 0x943CD476, 0x404A1BBC, 0x89CF0CD4, 0xD6C5D90E, 0x26EA2AB8, 0x642D4AD6, 0x404A1BBD, 0x89CF0CD4, 0xDF05C0E6, 0x80E07AEA, 0x1BB0BBCA, 0x743F4F1D, 0xA419A3A4, 0x883292AE, 0x7E5343DC, 0x458A21A4, 0x375A8726, 0x3E2EC92C, 0xDF66532F, 0x1835AAE1, 0xCFF07660, 0, 0];
var a2 = [0, 0, 0x9B8AD6F4, 0xE3AB6A3, 0x8EE0D59C, 0x100E814F, 0x22750C3E, 0x155629A2, 0x5FFF37E8, 0xD141F50E, 0x3E5263D3, 0xE513517F, 0x75272BBF, 0xB3695596, 0x5C24A2D9, 0xBE28D183, 0xD880CDA9, 0x272EBA1B, 0x7D1E0B5F, 0x8A99AC1F, 0xBE28D184, 0xD880CDA9, 0x8BA3E327, 0x6EE354BB, 0xFBB8D683, 0xAE1A5034, 0xB60BC16B, 0x11D89079, 0x1D1ED377, 0xB957B711, 0x7FD66DB0, 0xF36D7C2A, 0xB2078E5B, 0xC9B4B5C8, 0x2E750945, 0x1, 0];
var a3 = [0, 0, 0, 0x3F5595C0, 0x766BBD79, 0xD5451C2C, 0x541235FE, 0x5F34AF4C, 0xDC190CE4, 0x176788F3, 0x83E0C0EB, 0x73B53311, 0x7E865F55, 0xF2EED1A0, 0x581E2B55, 0x240C713D, 0x3C07874A, 0x27328E7F, 0x38420569, 0x5CE62E8C, 0xDBC0F13C, 0xE7F5514C, 0xC7FDDF32, 0x9B7E8E44, 0xBBEA6311, 0x2D254C7D, 0xC852543A, 0xA8AC2F29, 0x84A8C988, 0x7B33C0AF, 0x8CF99C2B, 0x1, 0];
var a4 = [0, 0, 0, 0, 0xE320548C, 0x11927E4A, 0x57943EE5, 0x33F627A8, 0x8BE716C1, 0xC28CE3D4, 0xD04F3DF8, 0xCD0885FB, 0xBCBAF6D2, 0x368A6DE3, 0x8E86BD68, 0x8F89845F, 0xB632EFA8, 0x6BABF50A, 0x9D039430, 0x957830B1, 0x5A97BCAA, 0x71860156, 0x37B5CD62, 0x111C7D6F, 0xB60BA169, 0x9BDAFCFC, 0xFC11BA3F, 0xAEF0FE37, 0x6679264C, 0xEA11C7D5, 0xDCA0B695, 0x12E75092, 0];


function doEval(e) {
  if (!e) return e;
  var Log = e.parentNode.lastElementChild;
  if (e.nodeName != 'INPUT')
    while((e = e.previousElementSibling) != null)
      if (e.nodeName == 'INPUT')
        break;

  //if (!e) return e;
  var s = eval(e.value);
  Log.innerHTML = s;
}

function ckEnter(ed) {
  if (event.keyCode != 13) return;
  while((ed = ed.nextElementSibling) != null)
    if (ed.nodeName == 'BUTTON')
      break;
  if (!ed) return ed;
  ed.click();
}


function dotesb2n(e) {
  validdecdigits='0123456789';
  var Log = e.parentNode.lastElementChild;
  var ed = e;
  if (ed.nodeName != 'INPUT')
    while((ed = e.previousElementSibling) != null)
      if (ed.nodeName == 'INPUT')
        break;

  var b = ed.value;
  var Len1 = b.length - 1;
  for (var i = Len1; i >= 0; i--)
    if (validdecdigits.indexOf(b[i]) < 0)
      b = b.substr(0, i) + b.substr(i + 1);
  b >>>= 5;
  b &= 2047;
  if (!b) b = 1;
  ed.value = b << 5;
  if (+(ed.value) > 16000) {
    //var msie = 'Microsoft Internet Explorer';
    var sl = '';
    sl += navigator.appName + ':' + LF;
    sl += 'Calculating ' + ed.value + '-bits wide data may take a while.' +LF;
    sl += 'Browser may render irresponsive, and you might get asked to continue.';
    Log.innerText = sl;
    //if (navigator.appName == msie)
      alert(sl);
  }

  var s = '', Len = b;
  s += PREBR;

  var A = [];
  for (var i = 0; i < Len; i++)
    A[i] = parseInt(Math.random() * 0x100000000);


  var t0, t1;

  t0 =  new Date().valueOf();
  var hexs = _buftoHexs(A);
  t1 =  new Date().valueOf();
  var tm_hexs = t1 - t0;



  t0 =  new Date().valueOf();
  var decs = _buftoDecimals(A);
  t1 =  new Date().valueOf();
  var tm_decs = t1 - t0;


  var e = A.toString().split(',');
  var top = e.length - 1;
  for (var i = 0; i < top; i++) if (+e[i] > 0) e[i] += ' * 2^(32*' + i +') + ';
  if (+e[top] > 0) e[top] += ' * 2 ^(32*' + top +')';

  e = e.join('');

  var d = decs;
  var bcd = '';
  bcd += '### /* debug items (for unix bc): */' + LF;
  bcd += 'tes77e = ' + e + LF;
  bcd += 'tes77d = ' + d + LF;
  bcd += 'tes77e' + LF;
  bcd += '# n2a(tes77e)' + LF;
  bcd += '# n2a(tes77d)' + LF;
  bcd += 'print "result: ", tes77e == tes77d, "\\n"' + LF;
  bcd += ' ###' + LF;
 
  s += '<b>' + 'Size: ' + A.length * 32 + '-bits' + '</b>' + LF
  s += 'A = [' + A + ']' + LF;

  s += 'Hexs: ' + hexs + LF;
  s += '<b>';
  s += 'Decimals (length: ' + decs.length +', time: ' + tm_decs/1000 + '): ';
  s += 'tes77d' + LF;
  s += '</b>' + LF;
  //s += decs + '</b>' + LF;
  s += bcd;


  Log.innerHTML = s;

}


</script>
</head>
<body>

<div id=div1 class=nowr>
eval1
<input size=40 onkeypress="ckEnter(this);" value="Math.random() * 0x100000000 |0">
<button onClick="doEval(this);">&nbsp;</button> |
<input class=ta-r size=4 onkeypress="ckEnter(this);" value="188">-bits
<button onClick="dotesb2n(this);">&nbsp;</button> |
<br>
<span id=span1></span>
</div>
<hr>

<div id=div2>
eval2
<input size=40 value="A=[1231,4562,7893,10114,12135,14156,16177,18198,20219,222310]; _buftoDecimals(A);" onkeypress="ckEnter(this);">
<!--
error list

i:1; r=-1; A = [2088166231, 3636569033, 2233208450]
i:1; r=-2; A = [3942296862,1205751363,2836470718]
i:1; r=-3; A = [201011797,3638126305,3655392895]
i:1; r=-4; A = [1285574232,1261892891,4170559358]
i:1; r=-4; A = [3338806776,1489345437,3922691048]
i:6; r=-1; A = [2442354106,4286162577,3929160408]
         
i:1; r=-2; A = [1010802622,3076125640,3160352908,3993195353]
i:1; r=-3; A = [3116209541,617332679,1128125176,4164567346]
i:1; r=-3; A = [1340885061,3306653763,929594931,4044000922]
i:5; r=-2; A = [1756759740,2764258153,2893758339,93534917]
i:6; r=-1; A = [3177538711,3193681375,1982239295,4028521689]
i:6; r=-1; A = [2285440105,3539662407,2362944324,2759582102]
i:6; r=-1; A = [1159668380,888344591,1467360232,3794248714]
i:10; r=-1; A = [1592207496,2713267767,2153740577,175288761]

i:10; r=-2; A = [814867465,3424354200,195362175,1008503681,164926031]
i:10; r=-3; A = [2276383440,702806697,2351943119,3706996868,200186135]
i:15; r=-2; A = [337164394,3449646284,3960217035,2342092858,509597782]

i:1; r=-3; A = [1438982553,1912889061,4240360321,1189993219,3805634177,4137582031];
i:15; r=-2; A = [3061293274,4019735719,4112413071,733409201,1493188401,445156508];
i:20; r=-2; A = [651003188,968636890,3191153588,88904936,3132776638,1180454121];


i:25 r=-2 A = [953244977,2389093605,4175305499,2691224267,2970568977,3803461846,2131312186,1729187013]
i:6 r=-1 A = [3440728546,4128211911,2391498153,1534170748,2538747995,3212136004,526318050,4010917082]
-->


<button onClick="doEval(this);">&nbsp;</button> |
<button onClick="doEval(this);">&nbsp;</button> |
<br>
<span id=span2></span>
</div>
<hr>

<div id=div3>
eval3
<input size=40 onkeypress="ckEnter(this);">
<button onClick="doEval(this);">&nbsp;</button> |
<button onClick="doEval(this);">&nbsp;</button> |
<br>&nbsp;
<span id=span3></span>
</div>
<hr>

</body>
</html>
